name: PR Discord Webhook

on:
  pull_request:
    types: [opened, reopened]

jobs:
  send-discord-webhook:
    runs-on: ubuntu-latest

    steps:
      - name: Send Discord webhook
        env:
          DISCORD_WEBHOOK_URL: ${{ secrets.DISCORD_WEBHOOK_URL }}
          TITLE: ${{ github.event.pull_request.title }}
          URL: ${{ github.event.pull_request.html_url }}
          BODY: ${{ github.event.pull_request.body }}
          USER: ${{ github.event.pull_request.user.login }}
          HEAD: ${{ github.event.pull_request.head.ref }}
          BASE: ${{ github.event.pull_request.base.ref }}
          REPO: ${{ github.repository }}
          TIME: ${{ github.event.pull_request.created_at }}
        run: |
          JSON=$(jq -n --arg title "$TITLE" \
                      --arg url "$URL" \
                      --arg desc "${BODY:-ë‚´ìš© ì—†ìŒ}" \
                      --arg user "$USER" \
                      --arg branch "$HEAD â†’ $BASE" \
                      --arg repo "$REPO" \
                      --arg time "$TIME" \
          '{
            content: "ğŸ”” ìƒˆë¡œìš´ PRì´ ì—´ë ¸ìŠµë‹ˆë‹¤!",
            embeds: [{
              title: $title,
              url: $url,
              description: $desc,
              color: 3447003,
              fields: [
                { name: "ì‘ì„±ì", value: $user, inline: true },
                { name: "ë¸Œëœì¹˜", value: $branch, inline: true },
                { name: "ë ˆí¬ì§€í† ë¦¬", value: $repo, inline: false }
              ],
              timestamp: $time
            }]
          }')

          curl -X POST -H "Content-Type: application/json" -d "$JSON" "$DISCORD_WEBHOOK_URL"
